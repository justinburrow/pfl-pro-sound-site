---
// Background.astro
---

<div id="shader-canvas">
</div>

<style>
  #shader-canvas {
    width: 100%;
    height: 100%;
    position: fixed;
    z-index: -1;
    top: 0;
    left: 0;
  }
</style>

<script>
  import {
    ShaderMount,
    grainGradientFragmentShader,
    GrainGradientShapes,
    getShaderColorFromString,
    getShaderNoiseTexture
  } from '@paper-design/shaders';

  function loadNoiseTexture() {
    return new Promise((resolve, reject) => {
      const img = getShaderNoiseTexture();
      if (!img) {
        reject(new Error('Failed to load noise texture'));
        return;
      }
      if (img?.complete) {
        resolve(img);
      } else if (img) {
        img.onload = () => resolve(img);
      }
    });
  }

  const noiseTexture = await loadNoiseTexture();

  const container = document.getElementById('shader-canvas');
  if (!container) throw new Error('Shader canvas container not found');

  const colors = [
    '#422f5f',
    '#43556a',
    '#293969',
  ].map(c => getShaderColorFromString(c));

  const uniforms = {
    u_colorBack: getShaderColorFromString('#000000'),
    u_colors: colors,
    u_colorsCount: colors.length,
    u_softness: .6,
    u_intensity: .5,
    u_noise: .4,
    u_shape: GrainGradientShapes.corners,
    u_noiseTexture: noiseTexture as HTMLImageElement,
    u_fit: 2,
    u_scale: 1.3,
    u_rotation: 0,
    u_originX: 0.5,
    u_originY: 0.5,
    u_offsetX: 0,
    u_offsetY: 0,
    u_worldWidth: 0,
    u_worldHeight: 0,
  };

  const shader = new ShaderMount(
    container,
    grainGradientFragmentShader,
    uniforms,
    { alpha: true },
    .6 // speed
  );
</script>